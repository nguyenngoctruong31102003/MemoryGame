<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="Material/icon/Logo.png">
    <title>Tr√≤ ch∆°i gh√©p ƒë√¥i ghi nh·ªõ</title>
    <!-- <link rel="stylesheet" href="Material/style.css"> -->
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #C8C2E0;
            font-family: Arial, sans-serif;
        }

        .game-container {
            display: grid;
            /* grid-template-columns: repeat(4, 100px); */
            grid-gap: 10px;
        }

        .card {
            width: 100px;
            height: 100px;
            background-color: #9F2C57;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            cursor: pointer;
        }

        .flipped {
            background-color: #2ecc71;
        }

        .matched {
            background-color: #9594B4;
            cursor: default;
        }

        .scoreboard {
            margin-bottom: 20px;
            font-size: 20px;
        }

        #nextStep,
        #playAgain,
        #highScores {
            display: none;
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
        }

        /* Popup */
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 20px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
            white-space: nowrap;
            /* NgƒÉn ch·ªØ t·ª± ƒë·ªông xu·ªëng d√≤ng */
            overflow-x: auto;
            /* B·∫≠t thanh cu·ªôn ngang n·∫øu c·∫ßn */
            max-width: 90vw;
            /* ƒê·∫£m b·∫£o popup kh√¥ng qu√° to tr√™n m√†n h√¨nh */
        }
    </style>
</head>

<body>
    <!-- Body -->
    <div class="scoreboard">
        ƒêi·ªÉm c·ªßa b·∫°n: <span id="score">0</span> | Th·ªùi gian c√≤n l·∫°i: <span id="timer">10</span> gi√¢y
    </div>
    <div class="game-container" id="gameBoard"></div>
    <button id="nextStep" onclick="nextLevel()">Next Step</button>
    <button id="playAgain" onclick="resetGame()">Play Again</button>
    <button id="highScores" onclick="showHighScores()">ƒêi·ªÉm s·ªë cao nh·∫•t</button>
    <div id="popup" class="popup"></div>

    <!-- Javascript -->
    <!-- <script src="Material/script.js"></script> -->
    <script>
        const levels = [
            { rows: 3, cols: 2, time: 10 },
            { rows: 3, cols: 4, time: 30 },
            // { rows: 3, cols: 6, time: 40 },
            // { rows: 3, cols: 8, time: 50 },
            // { rows: 5, cols: 6, time: 60 },
            // { rows: 6, cols: 6, time: 70 },
            // { rows: 6, cols: 7, time: 80 }
        ];
        let emojis = ["üçé", "üçå", "üçá", "üçâ", "üçì", "üçí", "ü•ù", "üçç", "üçä", "üçã", "ü••", "üçë", "ü•≠", "üçà", "üçè"];
        let currentLevel = 0, score = 0, matchedPairs = 0;
        let cards, firstCard, secondCard, lockBoard = false;
        let timeLeft, timerInterval;
        let highScores = JSON.parse(localStorage.getItem("highScores")) || [0, 0, 0];
        let isPaused = false; // Bi·∫øn ki·ªÉm tra tr·∫°ng th√°i t·∫°m d·ª´ng th·ªùi gian

        function shuffle(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        // Popup Message
        function showPopup(message, persistent = false) {
            const popup = document.getElementById("popup");
            popup.innerHTML = message;

            if (persistent) {
                popup.innerHTML += `<br><button onclick="closePopup()" style="margin-top:10px; padding:5px 10px; font-size:16px;">ƒê√≥ng</button>`;
            }

            popup.style.display = "block";

            if (!persistent) {
                setTimeout(() => { popup.style.display = "none"; }, 5000);
            }
        }

        function closePopup() {
            document.getElementById("popup").style.display = "none";

            if (isPaused) {
                isPaused = false; // Ti·∫øp t·ª•c th·ªùi gian
                startTimer();
            }
        }

        function createBoard() {
            const gameBoard = document.getElementById("gameBoard");
            gameBoard.innerHTML = "";
            document.getElementById("nextStep").style.display = "none";
            document.getElementById("playAgain").style.display = "none";
            document.getElementById("highScores").style.display = "block";
            let level = levels[currentLevel];
            gameBoard.style.gridTemplateColumns = `repeat(${level.cols}, 100px)`;
            let pairs = (level.rows * level.cols) / 2;
            cards = shuffle([...emojis.slice(0, pairs), ...emojis.slice(0, pairs)]);

            cards.forEach((emoji, index) => {
                const card = document.createElement("div");
                card.classList.add("card");
                card.dataset.emoji = emoji;
                card.dataset.index = index;
                card.addEventListener("click", flipCard);
                gameBoard.appendChild(card);
            });
            timeLeft = level.time;
            document.getElementById("timer").textContent = timeLeft;
            startTimer();
        }

        function flipCard() {
            if (
                lockBoard ||
                this.classList.contains("flipped") ||
                this.classList.contains("matched")
            )
                return;

            this.classList.add("flipped");
            this.textContent = this.dataset.emoji;

            if (!firstCard) {
                firstCard = this;
                return;
            }

            secondCard = this;
            lockBoard = true;
            checkMatch();
        }

        function checkMatch() {
            if (firstCard.dataset.emoji === secondCard.dataset.emoji) {
                firstCard.classList.add("matched");
                secondCard.classList.add("matched");
                score++;
                matchedPairs++;
                document.getElementById("score").textContent = score;

                if (matchedPairs === cards.length / 2) {
                    clearInterval(timerInterval); // D·ª´ng th·ªùi gian khi ho√†n th√†nh v√≤ng ch∆°i
                    updateHighScores(); // C·∫≠p nh·∫≠t ƒëi·ªÉm s·ªë
                    setTimeout(() => document.getElementById("nextStep").style.display = "block", 1000);
                }
                resetBoard();

            } else {
                setTimeout(() => {
                    firstCard.classList.remove("flipped");
                    secondCard.classList.remove("flipped");
                    firstCard.textContent = "";
                    secondCard.textContent = "";
                    resetBoard();
                }, 1000);
            }
        }

        function resetBoard() {
            firstCard = null;
            secondCard = null;
            lockBoard = false;
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById("timer").textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    updateHighScores(); // C·∫≠p nh·∫≠t ƒëi·ªÉm s·ªë
                    setTimeout(() => {
                        showPopup(`B·∫°n d·ªü qu√° √®! [GOODLUCK TO YOU] <br>ƒêi·ªÉm c·ªßa b·∫°n: ${score}`);
                    }, 1000);
                    setTimeout(() => { document.getElementById("playAgain").style.display = "block"; }, 6000);
                }
            }, 1000);
        }

        function updateHighScores() {
            highScores.push(score);
            highScores.sort((a, b) => b - a);
            highScores = highScores.slice(0, 3);
            localStorage.setItem("highScores", JSON.stringify(highScores));
        }

        function showHighScores() {
            isPaused = true; // T·∫°m d·ª´ng th·ªùi gian
            clearInterval(timerInterval); // D·ª´ng ƒë·∫øm th·ªùi gian

            showPopup(
                `üèÜ Top ƒëi·ªÉm cao nh·∫•t üèÜ<br>
                    üî• Top 1: ${highScores[0]} ƒëi·ªÉm<br>
                    üí• Top 2: ${highScores[1]} ƒëi·ªÉm<br>
                    üöÄ Top 3: ${highScores[2]} ƒëi·ªÉm`,
                true // Popup s·∫Ω kh√¥ng t·ª± ƒë√≥ng
            );
        }

        function resetGame() {
            score = 0;
            currentLevel = 0;
            matchedPairs = 0;
            createBoard();
        }

        function nextLevel() {
            currentLevel++;
            if (currentLevel >= levels.length) {
                showPopup("Ch√∫c m·ª´ng! B·∫°n ƒë√£ ho√†n th√†nh t·∫•t c·∫£ c√°c v√≤ng.");
                setTimeout(resetGame, 2000);
            } else {
                matchedPairs = 0;
                createBoard();
            }
        }

        createBoard();
    </script>
</body>

</html>